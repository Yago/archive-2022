(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2144],{4519:function(e,i,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/understanding-next-image",function(){return s(43020)}])},43020:function(e,i,s){"use strict";s.r(i),s.d(i,{default:function(){return d},meta:function(){return a}});var n=s(85893),t=s(11151),r=s(47439);let a={title:"Understanding Next/Image",date:"2021-04-05T13:26:39Z",description:"With Next.js version 10, a new image component was introduced to offer modern format and on-demand optimisation for images as well. If you came from Gatsby, it's the Next.js answer to gastby-image and it just rocks!"},o=e=>{let{children:i}=e;return(0,n.jsx)(r.Z,{meta:a,children:i})};function l(e){let i={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.p,{children:"With Next.js version 10, a new image component was introduced to offer modern format and on-demand optimisation for images as well. If you came from Gatsby, it's the Next.js answer to gastby-image and it just rocks!"}),"\n",(0,n.jsxs)(i.blockquote,{children:["\n",(0,n.jsxs)(i.p,{children:["Images are always rendered in such a way as to avoid ",(0,n.jsx)(i.a,{href:"https://web.dev/cls/",children:"Cumulative Layout Shift"}),", a ",(0,n.jsx)(i.a,{href:"https://web.dev/vitals/",children:"Core Web Vital"})," that Google is going to ",(0,n.jsx)(i.a,{href:"https://webmasters.googleblog.com/2020/05/evaluating-page-experience.html",children:"use in search ranking"}),"."]}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"Weirdly, it's so simple and magic that I was struggling to know how to use it. Also, the doc is not great to really understand how it works and to advise you to the most common practice: responsive user interface."}),"\n",(0,n.jsx)(i.h2,{children:"Let's dive in"}),"\n",(0,n.jsxs)(i.p,{children:["If you read the short ",(0,n.jsx)(i.a,{href:"https://nextjs.org/docs/api-reference/next/image",children:"documentation page"})," about ",(0,n.jsx)(i.code,{children:"next/image"})," , the only example you will see is basically this one."]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-jsx",children:'<Image\n  src="/my-16-by-9-big-image.jpg"\n  alt="Picture of something nice"\n  width={1000}\n  height={1000}\n/>\n'})}),"\n",(0,n.jsxs)(i.p,{children:["It's an easy mistake to think that our output will be a 1000 by 1000 pixels image (and a 2x for retina), ",(0,n.jsx)(i.strong,{children:"but instead we've got a 1080 \xd7 608 pixels image stretched in a square"}),"... So before going further, we need to understand few concepts about this component."]}),"\n",(0,n.jsx)(i.h3,{children:"The layouts"}),"\n",(0,n.jsxs)(i.p,{children:["There is four different layout available for your ",(0,n.jsx)(i.code,{children:"<Image />"})," :"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:'layout="intrinsic"'})," is the default value; it's basically a CSS ",(0,n.jsx)(i.code,{children:"max-width"}),". In our example, the image will be 1000 pixels wide on desktop and will fit to its parent width on mobile, but the ",(0,n.jsx)(i.strong,{children:"resolution will not change, only the displayed size"}),"."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:'layout="fixed"'})," is pretty self-explanatory; just like a CSS ",(0,n.jsx)(i.code,{children:"width"}),", the image will be displayed in the defined sizes without any resizing. Here 1000 by 1000 pixels, but the resolution is still 1080 \xd7 608 pixels."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:'layout="responsive"'})," is the magic and maybe ",(0,n.jsx)(i.strong,{children:"the main one to remember"}),", because we are in 2021 and performances matter. This time it's more like a CSS ",(0,n.jsx)(i.code,{children:"width: 100%;"}),", but unlike the first two above, it will provide a large number of different resolutions in the ",(0,n.jsx)(i.code,{children:"srcset"})," output."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:'layout="fill"'})," is useful when you don't want (and don't need) to define a ",(0,n.jsx)(i.code,{children:"width"})," and a ",(0,n.jsx)(i.code,{children:"height"}),". It's a standard CSS ",(0,n.jsx)(i.code,{children:"object-fit"}),". For this variant only, you will be able to add the extra ",(0,n.jsx)(i.code,{children:"objectFit"})," and ",(0,n.jsx)(i.code,{children:"objectPosition"})," properties to your component; they work just like the related CSS specification. It also provides a responsive ",(0,n.jsx)(i.code,{children:"srcset"}),"."]}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"What you must remember:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["The ",(0,n.jsx)(i.code,{children:"width"})," and ",(0,n.jsx)(i.code,{children:"height"})," properties must match your image ratio, unless you are using ",(0,n.jsx)(i.code,{children:'layout="fill"'})]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"intrinsic"})," (by default) and ",(0,n.jsx)(i.code,{children:"fixed"})," are used for static resolutions and ",(0,n.jsx)(i.code,{children:"responsive"})," and ",(0,n.jsx)(i.code,{children:"fill"})," for responsive resolutions."]}),"\n",(0,n.jsxs)(i.li,{children:["If you know the image size, use ",(0,n.jsx)(i.code,{children:"responsive"})," and if you don't, use ",(0,n.jsx)(i.code,{children:"fill"})]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{children:"The resolutions"}),"\n",(0,n.jsxs)(i.p,{children:["As you can see in our example, the resolution doesn't quite match the size. It's because there are two *options in your ",(0,n.jsx)(i.code,{children:"next.config.js"})," that you must be aware of:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"deviceSizes"})," are large breakpoints"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"imageSizes"})," are small breakpoints"]}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"By default, these options are set this way:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-jsx",children:"module.exports = {\n  images: {\n    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],\n    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],\n  },\n}\n"})}),"\n",(0,n.jsxs)(i.p,{children:["These two arrays are merged to form a complete collection of potential widths. So, if like me, you want a picture resized precisely to 1000 by 1000 px (and 2000 for retina), these sizes must be present in the ",(0,n.jsx)(i.code,{children:"deviceSizes"})," array."]}),"\n",(0,n.jsxs)(i.p,{children:["** There are also other options to ",(0,n.jsx)(i.a,{href:"https://nextjs.org/docs/basic-features/image-optimization#domains",children:"allow external images"})," or to ",(0,n.jsx)(i.a,{href:"https://nextjs.org/docs/basic-features/image-optimization#loader",children:"define a custom loader"}),".*"]}),"\n",(0,n.jsx)(i.h3,{children:"Other available props"}),"\n",(0,n.jsxs)(i.p,{children:["Apart from the main things to know when using ",(0,n.jsx)(i.code,{children:"next/image"}),", there are some useful properties to be aware of:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"loader"})," is useful to pass a loader component"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"sizes"})," is to override the default sizes of ",(0,n.jsx)(i.code,{children:"100vw"}),", useful only when ",(0,n.jsx)(i.code,{children:'layout="responsive"'})," or ",(0,n.jsx)(i.code,{children:'layout="fill"'})," are defined"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"quality"})," can be used to override the default quality of ",(0,n.jsx)(i.code,{children:"75"})]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"priority"})," must be used only when the image is visible above the fold. It's ",(0,n.jsx)(i.code,{children:"false"})," by default."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"loading"})," is ",(0,n.jsx)(i.code,{children:"lazy"})," by default, but can be changed to ",(0,n.jsx)(i.code,{children:"eager"})," to force an immediate loading."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"unoptimized"})," if you want something close to the default ",(0,n.jsx)(i.code,{children:"<img />"})," behaviour."]}),"\n",(0,n.jsxs)(i.li,{children:["You can also use ",(0,n.jsx)(i.code,{children:"style"}),", ",(0,n.jsx)(i.code,{children:"srcSet"})," and ",(0,n.jsx)(i.code,{children:"decoding"})," to directly target the ",(0,n.jsx)(i.code,{children:"<img />"})]}),"\n"]}),"\n",(0,n.jsx)(i.h2,{children:"Examples"}),"\n",(0,n.jsxs)(i.p,{children:["Now that we better understand how ",(0,n.jsx)(i.code,{children:"next/image"})," works and how it can be configured, here is some real-life examples."]}),"\n",(0,n.jsx)(i.h3,{children:"Classic responsive"}),"\n",(0,n.jsx)(i.p,{children:"Example of a responsive image inside a blog post content."}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-jsx",children:'<Image\n  src="/my-16-by-9-big-image.jpg"\n  alt="Picture of something nice"\n  width={800}\n  height={450}\n  layout="responsive"\n  quality={65}\n/>\n{/* Or for the same result */}\n<Image\n  src="/my-16-by-9-big-image.jpg"\n  alt="Picture of something nice"\n  width={16}\n  height={9}\n  layout="responsive"\n  quality={65}\n/>\n'})}),"\n",(0,n.jsx)(i.h3,{children:"Automatic responsive"}),"\n",(0,n.jsxs)(i.p,{children:["As we quickly saw earlier, the ",(0,n.jsx)(i.code,{children:"size"})," property is ",(0,n.jsx)(i.code,{children:"100vw"})," by default. If you want a perfect match to your image size, you can use something like ",(0,n.jsx)(i.a,{href:"https://github.com/wellyshen/react-cool-dimensions",children:"react-cool-dimensions"})," and wrap the ",(0,n.jsx)(i.code,{children:"<Image />"})," into a new component."]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-jsx",children:"import React from 'react';\nimport useDimensions from 'react-cool-dimensions';\nimport Image from 'next/image';\n\nexport default (props): JSX.Element => {\n  const { observe, width } = useDimensions<HTMLDivElement | null>();\n\n  return (\n    <div ref={observe}>\n      <Image\n        {...props}\n        layout=\"responsive\"\n        quality={65}\n        sizes={width !== undefined ? `${Math.round(width)}px` : '100vw'}\n      />\n    </div>\n  );\n};\n"})}),"\n",(0,n.jsx)(i.h3,{children:"Unknown/variable size with fixed ratio"}),"\n",(0,n.jsxs)(i.p,{children:["Sometimes pictures came from an outside source (CMS, APIs, etc) and the image size (width, height) is not available or the ratio can vary. For this case, the ",(0,n.jsx)(i.code,{children:'layout="fill"'})," is very useful with something like ",(0,n.jsx)(i.a,{href:"https://github.com/tailwindlabs/tailwindcss-aspect-ratio",children:"@tailwindcss/aspect-ratio"}),"."]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-jsx",children:'<div className="aspect-w-16 aspect-h-9">\n  <Image\n    src="/my-big-variable-image.jpg"\n    alt="Picture of something nice"\n    layout="fill"\n    objectFit="cover"\n  />\n</div>\n'})}),"\n",(0,n.jsx)(i.h3,{children:"Unknown/variable size with variable ratio"}),"\n",(0,n.jsxs)(i.p,{children:["Sadly for the moment, ",(0,n.jsx)(i.strong,{children:"there is no way to respect an image ratio without knowing its width and height"})," or at least, its ratio. You can still define an area where the image will be rendered without crop. For example, here, inside a gray square."]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-jsx",children:'<div className="aspect-w-1 aspect-h-1 bg-gray-100">\n  <Image\n    src="/my-big-variable-image.jpg"\n    alt="Picture of something nice"\n    layout="fill"\n    objectFit="contain"\n  />\n</div>\n'})}),"\n",(0,n.jsx)(i.h2,{children:"Conclusion"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"next/image"})," is a great add to the Next.js ecosystem, especially for people coming from Gatsby. It provides a very simple way to add the responsive layers to your images without any complicated backend configuration. It's another great example of the capabilities of clients to manage the media from a frontend perspective. Let your backend deal with the sources images and let your client application deal with the size needed by the consumers."]})]})}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.jsx)(o,{...e,children:(0,n.jsx)(l,{...e})})}},62090:function(e,i,s){"use strict";s.d(i,{Z:function(){return d}});var n=s(85893);s(67294);var t=s(90512),r=s(41664),a=s.n(r),o=s(68658),l=s(81612),d=e=>{let{crumbs:i}=e;return(0,n.jsx)("nav",{"aria-label":"breadcrumb",className:"mb-6 transform md:translate-x-1 md:mb-0",children:(0,n.jsxs)("ol",{className:"inline-flex text-sm text-gray-600 lowercase md:text-lg opacity-60 hover:opacity-100 duration-500 transition-opacity transform md:-translate-x-full md:translate-y-2 md:-rotate-90 md:origin-right",children:[(0,n.jsx)("li",{children:(0,n.jsxs)(a(),{href:"/",className:"link",children:[(0,n.jsx)("span",{className:"sr-only",children:"Homepage"}),(0,n.jsx)(l.Z,{name:"tipi",className:"text-base md:text-lg"})]})}),i.map((e,i)=>{let{href:s,label:r}=e;return(0,o.Z)(s)?(0,n.jsxs)("li",{"aria-current":"page",children:[(0,n.jsx)("span",{className:"px-3","aria-hidden":!0,children:"\xb7"}),(0,n.jsx)("span",{className:(0,t.Z)("inline-block truncate",{maxWidth:250}),children:r})]},"crumb-".concat(i)):(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{className:"px-3","aria-hidden":!0,children:"\xb7"}),(0,n.jsx)(a(),{href:s,className:"link",children:r})]},"crumb-".concat(i))})]})})}},47439:function(e,i,s){"use strict";s.d(i,{Z:function(){return x}});var n=s(85893);s(67294);var t=s(47906),r=s(63595),a=s(62090),o=s(73574),l=s(29454),d=s(53659),c=s(8523),h=s(35045),x=e=>{let{children:i,meta:s}=e;return(0,n.jsxs)(d.Z,{outsideChildren:(0,n.jsx)(c.Z,{}),children:[(0,n.jsx)(h.Z,{title:s.title,description:s.description}),(0,n.jsx)(a.Z,{crumbs:[{href:"/blog",label:"Blog"},{label:s.title}]}),(0,n.jsxs)("article",{className:"w-full mx-auto mt-20 sm:w-10/12 md:w-2/3 xl:w-7/12 md:px-8",children:[(0,n.jsxs)(l.Z,{move:!1,children:[(0,n.jsx)("h1",{className:"text-3xl font-medium text-gray-900 md:text-4xl lg:text-5xl",children:s.title}),(0,n.jsx)(o.Z,{children:(0,n.jsxs)("h2",{className:"font-medium md:text-lg",children:[(0,n.jsx)("span",{children:"Yann Gouffon â€” "}),(0,t.WU)((0,r.D)(s.date),"PPP")]})})]}),(0,n.jsx)(l.Z,{className:"mt-16 font-serif text-lg text-gray-900 space-y-6 md:mt-14 prose-headings:pt-4 prose-p:leading-[1.618em] lg:text-xl xl:text-2xl xl:prose-p:leading-[1.618em] prose-a:text-blue prose-headings:font-sans prose-headings:font-medium prose-h2:text-[26px] xl:prose-h2:text-[28px] prose-h3:text-[19px] lg:prose-h3:text-[24px] xl:prose-h3:text-[27px] prose-h4:text-[18px] lg:prose-h4:text-[21px] xl:prose-h4:text-[25px] prose-strong:text-medium prose-ul:list-disc prose-ul:pl-3 prose-ul:space-y-3 prose-ul:leading-[1.618em] xl:prose-figure:w-[106%] xl:prose-figure:-translate-x-[2.8%] prose-figure:rounded-lg prose-figure:overflow-hidden prose-figure:my-8",children:i})]})]})}}},function(e){e.O(0,[1635,9757,3880,520,5098,7539,8523,2888,9774,179],function(){return e(e.s=4519)}),_N_E=e.O()}]);