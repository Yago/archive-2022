(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6134],{53810:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/immer-state-mutation",function(){return n(79453)}])},79453:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c},meta:function(){return o}});var a=n(85893),s=n(11151),r=n(47439);let o={path:"/blog/immer-state-mutation",title:"Immer: state mutation made simple",date:"2018-09-21T00:00:00.000Z",type:"post",description:"When your JavaScript application gets bigger, you’ll quickly need something like Redux to distribute data across your application and your components. With Redux or any kind of state management library, the idea is to trigger some actions with a payload, which will themselves alter the global data storage of the app using this portion of new data."},i=e=>{let{children:t}=e;return(0,a.jsx)(r.Z,{meta:o,children:t})};function l(e){let t={a:"a",code:"code",em:"em",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t.p,{children:["When your JavaScript application gets bigger, ",(0,a.jsxs)(t.strong,{children:["you’ll quickly need something like ",(0,a.jsx)(t.a,{href:"https://redux.js.org/",children:"Redux"})," to distribute data across your application and your components"]}),".  With Redux or any kind of state management library, the idea is to trigger some actions with a ",(0,a.jsx)(t.em,{children:"payload"}),", which will themselves alter the global data storage of the app using this portion of new data."]}),"\n",(0,a.jsxs)(t.p,{children:["It’s fairly easy to setup when you deal with simple data structure.  ",(0,a.jsx)(t.strong,{children:"For example"}),", if you want to update your ",(0,a.jsx)(t.code,{children:"content"})," at your Store’s root, you can do something like:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:'const reducer = (state = {}, action) => {\n  if (action.type === "ALTER_STORE") {\n    return {\n      ...state,\n      content: action.payload\n    };\n  }\n  return state;\n};\n'})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://codesandbox.io/s/rlo00m8lwn",children:"\uD83D\uDCE6 Play with the CodeSandbox example!"})}),"\n",(0,a.jsxs)(t.p,{children:["But when you’re starting to have a more complex data structure with nested objects and arrays, things became quickly tricky and after the Callbacks and the Promises of Hell, please welcome the “",(0,a.jsx)(t.em,{children:"Reducer of Hell"}),"” (thanks to Object Spread goodness)!"]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"For example"})," if your want to update a specific post’s ",(0,a.jsx)(t.code,{children:"content"})," attribute:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:'const complexDefaultState = {\n  contents: {\n    post: [\n      { id: 0, type: "post", content: "First article" },\n      { id: 1, type: "post", content: "Second article" },\n      { id: 2, type: "post", content: "Third article" }\n    ],\n    page: []\n  }\n};\n\nconst reducer = (state = complexDefaultState, action) => {\n  if (action.type === "ALTER_STORE") {\n    return {\n      ...state,\n      contents: {\n        ...state.contents,\n        [action.payload.type]: [\n          ...state.contents[action.payload.type].slice(0, action.payload.id),\n          {\n            ...state.contents[action.payload.type][action.payload.id],\n            ...action.payload\n          },\n          ...state.contents[action.payload.type].slice(action.payload.id + 1)\n        ]\n      }\n    };\n  }\n  return state;\n};\n'})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://codesandbox.io/s/64k1rzpyjk",children:"\uD83D\uDCE6 Play with the CodeSandbox example!"})}),"\n",(0,a.jsxs)(t.p,{children:["Dirty, right? Ok, maybe you can be smarter and start modeling something more decoupled and less nested, or maybe not… Thankfully, ",(0,a.jsx)(t.strong,{children:"Michel Weststrate"}),", the smart guy behind ",(0,a.jsx)(t.a,{href:"https://github.com/mobxjs/mobx",children:"MobX"}),", had provided us a more elegant solution for making state mutations: ",(0,a.jsx)(t.a,{href:"https://github.com/mweststrate/immer",children:"Immer.js"}),"!"]}),"\n",(0,a.jsxs)(t.p,{children:["You simply have to wrap your reducer inside the ",(0,a.jsx)(t.code,{children:"immer"})," method and replace your dirty mutation code by a more elegant one, same as native ",(0,a.jsx)(t.code,{children:"Array"}),"  and ",(0,a.jsx)(t.code,{children:"Object"})," prototype methods."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"For the same complex example"})," using Immer, your reducer will look like:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:'import p from "immer";\n\nconst complexDefaultState = {/* see previous example */};\n\nconst reducer = p((state = complexDefaultState, action) => {\n  if (action.type === "ALTER_STORE") {\n    state.contents[action.payload.type][action.payload.id].content =\n      action.payload.content;\n  }\n  return state;\n});\n'})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://codesandbox.io/s/047y582040",children:"\uD83D\uDCE6 Play with the CodeSandbox example!"})}),"\n",(0,a.jsxs)(t.p,{children:["Holy cow! Yep, my first reaction too. ",(0,a.jsx)(t.strong,{children:"Now you can handle complex Store data without having dirty reducers"}),". Complex data; clean, typed and performant reducers, what else?"]}),"\n",(0,a.jsxs)(t.p,{children:["I invite you to read all the good stuff of Immer.js on it ",(0,a.jsx)(t.a,{href:"https://github.com/mweststrate/immer",children:"repository"}),". There is a great and visual explanation of how it works under the hood and what are all the benefits of using it (aside of reducing your code size by 1,000)."]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.em,{children:"Supported with"})," \uD83D\uDC9B ",(0,a.jsxs)(t.em,{children:["by ",(0,a.jsx)(t.a,{href:"https://antistatique.net",children:"Antistatique"})]})]})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.jsx)(i,{...e,children:(0,a.jsx)(l,{...e})})}},62090:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var a=n(85893);n(67294);var s=n(90512),r=n(41664),o=n.n(r),i=n(68658),l=n(81612),c=e=>{let{crumbs:t}=e;return(0,a.jsx)("nav",{"aria-label":"breadcrumb",className:"mb-6 transform md:translate-x-1 md:mb-0",children:(0,a.jsxs)("ol",{className:"inline-flex text-sm text-gray-600 lowercase md:text-lg opacity-60 hover:opacity-100 duration-500 transition-opacity transform md:-translate-x-full md:translate-y-2 md:-rotate-90 md:origin-right",children:[(0,a.jsx)("li",{children:(0,a.jsxs)(o(),{href:"/",className:"link",children:[(0,a.jsx)("span",{className:"sr-only",children:"Homepage"}),(0,a.jsx)(l.Z,{name:"tipi",className:"text-base md:text-lg"})]})}),t.map((e,t)=>{let{href:n,label:r}=e;return(0,i.Z)(n)?(0,a.jsxs)("li",{"aria-current":"page",children:[(0,a.jsx)("span",{className:"px-3","aria-hidden":!0,children:"\xb7"}),(0,a.jsx)("span",{className:(0,s.Z)("inline-block truncate",{maxWidth:250}),children:r})]},"crumb-".concat(t)):(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"px-3","aria-hidden":!0,children:"\xb7"}),(0,a.jsx)(o(),{href:n,className:"link",children:r})]},"crumb-".concat(t))})]})})}},47439:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var a=n(85893);n(67294);var s=n(47906),r=n(63595),o=n(62090),i=n(73574),l=n(29454),c=n(53659),d=n(8523),p=n(35045),h=e=>{let{children:t,meta:n}=e;return(0,a.jsxs)(c.Z,{outsideChildren:(0,a.jsx)(d.Z,{}),children:[(0,a.jsx)(p.Z,{title:n.title,description:n.description}),(0,a.jsx)(o.Z,{crumbs:[{href:"/blog",label:"Blog"},{label:n.title}]}),(0,a.jsxs)("article",{className:"w-full mx-auto mt-20 sm:w-10/12 md:w-2/3 xl:w-7/12 md:px-8",children:[(0,a.jsxs)(l.Z,{move:!1,children:[(0,a.jsx)("h1",{className:"text-3xl font-medium text-gray-900 md:text-4xl lg:text-5xl",children:n.title}),(0,a.jsx)(i.Z,{children:(0,a.jsxs)("h2",{className:"font-medium md:text-lg",children:[(0,a.jsx)("span",{children:"Yann Gouffon — "}),(0,s.WU)((0,r.D)(n.date),"PPP")]})})]}),(0,a.jsx)(l.Z,{className:"mt-16 font-serif text-lg text-gray-900 space-y-6 md:mt-14 prose-headings:pt-4 prose-p:leading-[1.618em] lg:text-xl xl:text-2xl xl:prose-p:leading-[1.618em] prose-a:text-blue prose-headings:font-sans prose-headings:font-medium prose-h2:text-[26px] xl:prose-h2:text-[28px] prose-h3:text-[19px] lg:prose-h3:text-[24px] xl:prose-h3:text-[27px] prose-h4:text-[18px] lg:prose-h4:text-[21px] xl:prose-h4:text-[25px] prose-strong:text-medium prose-ul:list-disc prose-ul:pl-3 prose-ul:space-y-3 prose-ul:leading-[1.618em] xl:prose-figure:w-[106%] xl:prose-figure:-translate-x-[2.8%] prose-figure:rounded-lg prose-figure:overflow-hidden prose-figure:my-8",children:t})]})]})}}},function(e){e.O(0,[1635,9757,3880,520,5098,7539,8523,2888,9774,179],function(){return e(e.s=53810)}),_N_E=e.O()}]);